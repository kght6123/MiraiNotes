!function(e,t){"function"==typeof define&&define.amd?(e.marked=require("./marked"),e.RevealMarkdown=t(e.marked),e.RevealMarkdown.initialize()):"object"==typeof exports?module.exports=t(require("./marked")):(e.RevealMarkdown=t(e.marked),e.RevealMarkdown.initialize())}(this,function(e){var t="^\r?\n---\r?\n$",a="notes?:",r="\\.element\\s*?(.+?)$",n="\\.slide:\\s*?(\\S.+?)$",i="__SCRIPT_END__";function o(e){var t=(e.querySelector("[data-template]")||e.querySelector("script")||e).textContent,a=(t=t.replace(new RegExp(i,"g"),"<\/script>")).match(/^\n?(\s*)/)[1].length,r=t.match(/^\n?(\t*)/)[1].length;return r>0?t=t.replace(new RegExp("\\n?\\t{"+r+"}","g"),"\n"):a>1&&(t=t.replace(new RegExp("\\n? {"+a+"}","g"),"\n")),t}function s(e){for(var t=e.attributes,a=[],r=0,n=t.length;r<n;r++){var i=t[r].name,o=t[r].value;/data\-(markdown|separator|vertical|notes)/gi.test(i)||(o?a.push(i+'="'+o+'"'):a.push(i))}return a.join(" ")}function l(e){return(e=e||{}).separator=e.separator||t,e.notesSeparator=e.notesSeparator||a,e.attributes=e.attributes||"",e}function d(t,a){a=l(a);var r=t.split(new RegExp(a.notesSeparator,"mgi"));return 2===r.length&&(t=r[0]+'<aside class="notes">'+e(r[1].trim())+"</aside>"),'<script type="text/template">'+(t=t.replace(/<\/script>/g,i))+"<\/script>"}function u(e,t){t=l(t);for(var a,r,n,i=new RegExp(t.separator+(t.verticalSeparator?"|"+t.verticalSeparator:""),"mg"),o=new RegExp(t.separator),s=0,u=!0,c=[];a=i.exec(e);)notes=null,!(r=o.test(a[0]))&&u&&c.push([]),n=e.substring(s,a.index),r&&u?c.push(n):c[c.length-1].push(n),s=i.lastIndex,u=r;(u?c:c[c.length-1]).push(e.substring(s));for(var p="",h=0,m=c.length;h<m;h++)c[h]instanceof Array?(p+="<section "+t.attributes+">",c[h].forEach(function(e){p+="<section data-markdown>"+d(e,t)+"</section>"}),p+="</section>"):p+="<section "+t.attributes+" data-markdown>"+d(c[h],t)+"</section>";return p}function c(){for(var e,t=document.querySelectorAll("[data-markdown]"),a=0,r=t.length;a<r;a++)if((e=t[a]).getAttribute("data-markdown").length){var n=new XMLHttpRequest,i=e.getAttribute("data-markdown");datacharset=e.getAttribute("data-charset"),null!=datacharset&&""!=datacharset&&n.overrideMimeType("text/html; charset="+datacharset),n.onreadystatechange=function(){4===n.readyState&&(n.status>=200&&n.status<300||0===n.status?e.outerHTML=u(n.responseText,{separator:e.getAttribute("data-separator"),verticalSeparator:e.getAttribute("data-separator-vertical"),notesSeparator:e.getAttribute("data-separator-notes"),attributes:s(e)}):e.outerHTML='<section data-state="alert">ERROR: The attempt to fetch '+i+" failed with HTTP status "+n.status+".Check your browser's JavaScript console for more details.<p>Remember that you need to serve the presentation HTML from a HTTP server.</p></section>")},n.open("GET",i,!1);try{n.send()}catch(e){alert("Failed to get the Markdown file "+i+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+e)}}else e.getAttribute("data-separator")||e.getAttribute("data-separator-vertical")||e.getAttribute("data-separator-notes")?e.outerHTML=u(o(e),{separator:e.getAttribute("data-separator"),verticalSeparator:e.getAttribute("data-separator-vertical"),notesSeparator:e.getAttribute("data-separator-notes"),attributes:s(e)}):e.innerHTML=d(o(e))}function p(e,t,a){var r=new RegExp(a,"mg"),n=new RegExp('([^"= ]+?)="([^"=]+?)"',"mg"),i=e.nodeValue;if(matches=r.exec(i)){var o=matches[1];for(i=i.substring(0,matches.index)+i.substring(r.lastIndex),e.nodeValue=i;matchesClass=n.exec(o);)t.setAttribute(matchesClass[1],matchesClass[2]);return!0}return!1}function h(e,t,a,r,n){if(null!=t&&null!=t.childNodes&&t.childNodes.length>0){previousParentElement=t;for(var i=0;i<t.childNodes.length;i++){if(childElement=t.childNodes[i],i>0)for(j=i-1;j>=0;){if(aPreviousChildElement=t.childNodes[j],"function"==typeof aPreviousChildElement.setAttribute&&"BR"!=aPreviousChildElement.tagName){previousParentElement=aPreviousChildElement;break}j-=1}parentSection=e,"section"==childElement.nodeName&&(parentSection=childElement,previousParentElement=childElement),"function"!=typeof childElement.setAttribute&&childElement.nodeType!=Node.COMMENT_NODE||h(parentSection,childElement,previousParentElement,r,n)}}t.nodeType==Node.COMMENT_NODE&&0==p(t,a,r)&&p(t,e,n)}function m(){for(var t=document.querySelectorAll("[data-markdown]"),a=0,i=t.length;a<i;a++){var s=t[a];if(!s.getAttribute("data-markdown-parsed")){s.setAttribute("data-markdown-parsed",!0);var l=s.querySelector("aside.notes"),d=o(s);s.innerHTML=e(d),h(s,s,null,s.getAttribute("data-element-attributes")||s.parentNode.getAttribute("data-element-attributes")||r,s.getAttribute("data-attributes")||s.parentNode.getAttribute("data-attributes")||n),l&&s.appendChild(l)}}}return{initialize:function(){if(void 0===e)throw"The reveal.js Markdown plugin requires marked to be loaded";"undefined"!=typeof hljs&&e.setOptions({highlight:function(e,t){return hljs.highlightAuto(e,[t]).value}});var t=Reveal.getConfig().markdown;t&&e.setOptions(t),c(),m()},processSlides:c,convertSlides:m,slidify:u}});
